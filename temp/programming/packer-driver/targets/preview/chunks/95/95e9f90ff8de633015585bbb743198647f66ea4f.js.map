{"version":3,"sources":["file:///D:/cocos_projects/physics_education_game/assets/scripts/manager/map_manager/MapData.ts"],"names":["MapData","_decorator","Singleton","LogManager","ResManager","LoadType","ccclass","property","constructor","inited","init","finishCb","mapDatas","getInstance","loadBundle","loadAsset","JSON","json","mapData","mode2MapDatas","i","length","modeItemData","modeID","modeId","err","error","getModeDatas","warn","getModeDatasById","loadMapData","mapName"],"mappings":"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","sourcesContent":["\nimport { _decorator, JsonAsset } from \"cc\";\nimport { Singleton } from \"../../common/Singleton\";\nimport LogManager from \"../../utils/LogManager\";\nimport { ResManager, LoadType } from \"../ResManager\";\nimport { IPreInit } from \"../../common/IPreInit\";\nimport { PhysicsParam } from \"../../modules/game/ObjectBase\";\n\nconst { ccclass, property } = _decorator;\n\nexport interface IOpenObjectData {\n    objectId: number,\n    name: string,\n    pos: string,\n    rot: string,\n    sca: string,\n    objectType: number,\n    shapeParam: any,\n    objectParam: any,\n    physicsParam: PhysicsParam,\n}\n\nexport interface IOpenMapData {\n    mapPath: string,\n    objectDatas: any,\n}\n\nexport interface IMapConfig {\n    modeId: number,\n    modeName: string,\n    modeBg: string\n    levelDatas: {\n        levelId: number,\n        levelPath: string,\n        isLock: number,\n    }[],\n}\n\nexport default class MapData extends Singleton {\n    private inited: boolean = false;\n    private mapDatas: { [mapName: string]: IOpenMapData };\n    private mode2MapDatas: { [mode: number]: IMapConfig };\n\n    constructor() {\n        super();\n    }\n\n    public init(finishCb?: () => void) {\n        this.mapDatas = {};\n        ResManager.getInstance().loadBundle(\"map\", () => {\n            this.inited = true;\n            ResManager.getInstance().loadAsset(\"mapConfig\", LoadType.JSON, \"map\", (json: JsonAsset) => {\n                let mapData = json.json as IMapConfig[];\n                if (mapData) {\n                    this.mode2MapDatas = {};\n                    for (let i = 0; i < mapData.length; i++) {\n                        const modeItemData = mapData[i];\n                        const modeID = modeItemData.modeId;\n                        this.mode2MapDatas[modeID] = modeItemData;\n                    }\n                }\n                if (finishCb) {\n                    finishCb();\n                }\n            }, (err) => {\n                LogManager.error(err);\n            });\n        });\n    }\n\n    public getModeDatas() {\n        if (!this.inited) {\n            LogManager.warn(\"MapManager未初始化\");\n            return;\n        }\n        return this.mode2MapDatas;\n    }\n\n    public getModeDatasById(modeId: number) {\n        if (!this.inited) {\n            LogManager.warn(\"MapManager未初始化\");\n            return;\n        }\n        if (this.getModeDatas) {\n            return this.mode2MapDatas[modeId];\n        }\n    }\n\n    public loadMapData(mapName: string, finishCb?: (mapData: IOpenMapData) => void) {\n        if (!this.inited) {\n            LogManager.warn(\"MapManager未初始化\");\n            return;\n        }\n        if (this.mapDatas[mapName]) {\n            let mapData = this.mapDatas[mapName];\n            finishCb?.(mapData);\n        }\n        else {\n            ResManager.getInstance().loadAsset(mapName, LoadType.JSON, \"map\", (json: JsonAsset) => {\n                let mapData = json.json as IOpenMapData;\n                this.mapDatas[mapName] = mapData;\n                finishCb?.(mapData);\n            }, (err) => {\n                LogManager.error(err);\n            });\n        }\n    }\n}"]}
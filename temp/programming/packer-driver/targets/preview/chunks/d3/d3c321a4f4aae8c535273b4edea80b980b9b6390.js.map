{"version":3,"sources":["file:///E:/education_game/game/assets/scripts/manager/game_manager/GameManager.ts"],"names":["_decorator","director","PhysicsSystem2D","Singleton","ObjectVisualTag","GameTipManager","InputManager","MapManager","ccclass","GameState","GameManager","init","_gameState","NotInGame","_gameRoot","getScene","getChildByName","_gameObjects","tag","_curDetectObjects","console","log","nextInitManager","setNextInitManager","gameState","gameRoot","start","Ongoing","instance","enable","getInstance","enterMap","pause","i","length","object","Pause","resume","update","deltaTime","mouseParam","getMouseData","showTipObject","undefined","objectInTag","applyForce","isMouseIn","contains","mousePos","lastDetectIndex","findIndex","item","getObjectInfo","id","onMouseEnterSpace","push","onMouseLeaveSpace","splice","objectInfo","showTip","name","tipData","moveTip","hideTip","addObject","visualTag","removeObject"],"mappings":"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","sourcesContent":["import { _decorator, director, Vec2, Node, PhysicsSystem2D } from \"cc\";\nimport { Singleton } from \"../../common/Singleton\";\nimport { ObjectBase, ObjectVisualTag } from \"../../modules/game/ObjectBase\";\nimport { GameTipManager } from \"../../modules/ui/game_tip/GameTipManager\";\nimport { InputManager, MouseParam } from \"../InputManager\";\nimport { MapManager } from \"../map_manager/MapManager\";\nimport { IPreInit } from \"../../common/IPreInit\";\nconst { ccclass } = _decorator;\n\nexport enum GameState {\n    NotInGame,\n    Pause,\n    Ongoing,\n}\n\n\n@ccclass('GameManager')\nexport class GameManager extends Singleton {\n    private _gameState: GameState;\n\n    // 应该引入一个ObjectManager的东西\n    private _gameRoot: Node;\n    // private _gameObjects: ObjectBase[][];   // 物体的输入有优先级的区分，0级为最优先，依次递减\n    private _gameObjects: { [tag: number]: ObjectBase[] };\n    private _curDetectObjects: ObjectBase[];       // 当前鼠标检测到的物体\n\n    public init() {\n        this._gameState = GameState.NotInGame;\n        this._gameRoot = director.getScene().getChildByName(\"main_canvas\").getChildByName(\"game_root\");\n        this._gameObjects = {};\n        for (let tag in ObjectVisualTag) {\n            this._gameObjects[tag] = [];\n        }\n        this._curDetectObjects = [];\n\n        console.log(\"GameManager初始化完成!\");\n        if (this.nextInitManager) {\n            this.nextInitManager.init();\n        }\n    }\n\n    public nextInitManager: IPreInit;\n    public setNextInitManager(nextInitManager: IPreInit): void {\n        this.nextInitManager = nextInitManager;\n    }\n\n    public get gameState() {\n        return this._gameState;\n    }\n\n    public get gameRoot() {\n        return this._gameRoot;\n    }\n\n    public start() {\n        this._gameState = GameState.Ongoing;\n        PhysicsSystem2D.instance.enable = true;\n        MapManager.getInstance().enterMap(\"100001\");\n    }\n\n    public pause() {\n        if (this._gameState != GameState.Ongoing) {\n            return;\n        }\n        for (const tag in this._gameObjects) {\n            for (let i = 0; i < this._gameObjects[tag].length; i++) {\n                const object = this._gameObjects[tag][i];\n                if (!object) {\n                    continue;\n                }\n                object.pause();\n            }\n        }\n        this._gameState = GameState.Pause;\n    }\n\n    public resume() {\n        if (this._gameState != GameState.Pause) {\n            return;\n        }\n        for (const tag in this._gameObjects) {\n            for (let i = 0; i < this._gameObjects[tag].length; i++) {\n                const object = this._gameObjects[tag][i];\n                if (!object) {\n                    continue;\n                }\n                object.resume();\n            }\n        }\n        this._gameState = GameState.Ongoing;\n    }\n\n    public update(deltaTime: number) {\n        let mouseParam = InputManager.getInstance().getMouseData();\n        let showTipObject: ObjectBase = undefined;      // 要显示提示的Object\n\n        for (const tag in this._gameObjects) {\n            const objectInTag = this._gameObjects[tag];\n            for (let i = 0; i < objectInTag.length; i++) {\n                const object = objectInTag[i];\n                object.applyForce();\n\n                const isMouseIn = object.contains(mouseParam.mousePos);\n                let lastDetectIndex = this._curDetectObjects.findIndex((item) => {\n                    if (object.getObjectInfo().id == item.getObjectInfo().id) {\n                        return true;\n                    }\n                    return false;\n                });\n                if (isMouseIn) {\n                    showTipObject = object;\n                    if (lastDetectIndex >= 0) {\n\n                    } else {\n                        object.onMouseEnterSpace(mouseParam);\n                        this._curDetectObjects.push(object);\n                    }\n                } else {\n                    if (lastDetectIndex >= 0) {\n                        object.onMouseLeaveSpace(mouseParam);\n                        this._curDetectObjects.splice(lastDetectIndex, 1);\n                    } else {\n\n                    }\n                }\n            }\n        }\n        if (showTipObject) {\n            let objectInfo = showTipObject.getObjectInfo();\n            GameTipManager.getInstance().showTip(objectInfo.id, objectInfo.name, objectInfo.tipData);\n            GameTipManager.getInstance().moveTip(mouseParam.mousePos);\n        } else {\n            GameTipManager.getInstance().hideTip();\n        }\n    }\n\n    public addObject(object: ObjectBase, visualTag: ObjectVisualTag) {\n        this._gameObjects[visualTag].push(object);\n    }\n\n    public removeObject(object: ObjectBase) {\n        //this._gameObjects.\n    }\n}"]}
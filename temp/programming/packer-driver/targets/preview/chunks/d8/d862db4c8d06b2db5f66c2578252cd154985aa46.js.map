{"version":3,"sources":["file:///D:/cocos_projects/physics_education_game/assets/scripts/modules/ui/game_panel/GridSquare.ts"],"names":["_decorator","Component","tween","Vec3","Utils","ccclass","property","GridSquare","gridOriginSize","x","y","maxScale","minScale","zoomSpeed","moveSpeedRate","init","reset","initFunc","zoomIn","targetScale","clamp","_curScale","targetPosX","node","getPosition","targetPosY","_tweenAnim","stop","to","scale","position","start","zoomOut","move","deltaPos","setPosition","setScale"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Tween, tween, UITransform, v2, Vec2, Vec3 } from 'cc';\r\nimport Utils from '../../../utils/Utils';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n@ccclass('GridSquare')\r\nexport class GridSquare extends Component {\r\n    private readonly gridOriginSize: { x: number, y: number } = { x: 64, y: 64 };\r\n    private readonly maxScale: number = 3;\r\n    private readonly minScale: number = 0.5;\r\n    private readonly zoomSpeed: number = 0.1;\r\n    private readonly moveSpeedRate: number = 0.4;\r\n\r\n    private _curScale: number;\r\n    private _tweenAnim: Tween<Node>;\r\n\r\n    public init() {\r\n        this.reset();\r\n        this.initFunc();\r\n    }\r\n\r\n    private initFunc() {\r\n        //EventManager.getInstance().addListener(EventStr.StartZoomInGrid, this.onZoomInGrid);\r\n        //EventManager.getInstance().addListener(EventStr.StartZoomOutGrid, this.onZoomInGrid);\r\n        //EventManager.getInstance().addListener(EventStr.EndZoomInGrid, this.onZoomInGrid);\r\n        //EventManager.getInstance().addListener(EventStr.EndZoomOutGrid, this.onZoomInGrid);\r\n    }\r\n\r\n    public zoomIn() {\r\n        let targetScale = Utils.clamp(this._curScale + this.zoomSpeed, this.minScale, this.maxScale);\r\n        let targetPosX = this.node.getPosition().x * targetScale / this._curScale;\r\n        let targetPosY = this.node.getPosition().y * targetScale / this._curScale;\r\n        this._curScale = targetScale;\r\n\r\n        this._tweenAnim?.stop();\r\n        this._tweenAnim = tween(this.node)\r\n            .to(0.2, { scale: new Vec3(targetScale, targetScale, 1), position: new Vec3(targetPosX, targetPosY, 0) });\r\n        this._tweenAnim.start();\r\n    }\r\n\r\n    public zoomOut() {\r\n        let targetScale = Utils.clamp(this._curScale - this.zoomSpeed, this.minScale, this.maxScale);\r\n        let targetPosX = this.node.getPosition().x * targetScale / this._curScale;\r\n        let targetPosY = this.node.getPosition().y * targetScale / this._curScale;\r\n        this._curScale = targetScale;\r\n\r\n        this._tweenAnim?.stop();\r\n        this._tweenAnim = tween(this.node)\r\n            .to(0.2, { scale: new Vec3(targetScale, targetScale, 1), position: new Vec3(targetPosX, targetPosY, 0) });\r\n        this._tweenAnim.start();\r\n    }\r\n\r\n    public move(deltaPos: Vec2) {\r\n        let targetPosX = this.node.getPosition().x + deltaPos.x * this.moveSpeedRate;\r\n        let targetPosY = this.node.getPosition().y + deltaPos.y * this.moveSpeedRate;\r\n        while (targetPosX > this.gridOriginSize.x * this._curScale) {\r\n            targetPosX -= this.gridOriginSize.x * this._curScale;\r\n        }\r\n        while (targetPosX < -this.gridOriginSize.x * this._curScale) {\r\n            targetPosX += this.gridOriginSize.x * this._curScale;\r\n        }\r\n        while (targetPosY > this.gridOriginSize.y * this._curScale) {\r\n            targetPosY -= this.gridOriginSize.y * this._curScale;\r\n        }\r\n        while (targetPosY < -this.gridOriginSize.y * this._curScale) {\r\n            targetPosY += this.gridOriginSize.y * this._curScale;\r\n        }\r\n        this.node.setPosition(targetPosX, targetPosY, 0);\r\n    }\r\n\r\n    private reset() {\r\n        this._curScale = 1;\r\n        this.node.setPosition(0, 0, 0);\r\n        this.node.setScale(1, 1, 1);\r\n    }\r\n}\r\n\r\n\r\n"]}
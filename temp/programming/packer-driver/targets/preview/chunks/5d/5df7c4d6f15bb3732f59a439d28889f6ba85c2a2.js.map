{"version":3,"sources":["file:///D:/cocos_projects/physics_education_game/assets/scripts/manager/game_manager/GameManager.ts"],"names":["ccclass","_decorator","GameState","GameManager","Singleton","init","_gameState","Ongoing","_gameRoot","director","getScene","getChildByName","_gameObjects","_objectFactory","ObjectFactory","getInstance","_inputMgr","InputManager","_gameTipMgr","GameTipManager","_mapMgr","MapManager","enterMap","console","log","gameState","gameRoot","pause","Pause","unpause","update","deltaTime","curMousePos","mousePos","param","hasShowTip","i","length","object","contains","_curDetectObject","showTip","getObjectParam","name","getTipData","moveTip","mouseOnObject","hideTip","addObject","push","removeObject"],"mappings":"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","sourcesContent":["\r\n\r\nconst { ccclass } = _decorator;\r\n\r\nenum GameState {\r\n    NotInGame,\r\n    Pause,\r\n    Ongoing,\r\n}\r\n\r\n\r\n@ccclass('GameManager')\r\nexport class GameManager extends Singleton {\r\n    private _gameState: GameState;\r\n\r\n    // 应该引入一个ObjectManager的东西\r\n    private _gameRoot: Node;\r\n    // private _gameObjects: ObjectBase[][];   // 物体的输入有优先级的区分，0级为最优先，依次递减\r\n    private _gameObjects: ObjectBase[];\r\n    private _curDetectObject: ObjectBase;       // 当前鼠标检测到的物体\r\n\r\n    private _inputMgr: InputManager;\r\n    private _objectFactory: ObjectFactory;\r\n    private _gameTipMgr: GameTipManager;\r\n    private _mapMgr: MapManager;\r\n\r\n    public init() {\r\n        this._gameState = GameState.Ongoing;\r\n        this._gameRoot = director.getScene().getChildByName(\"main_canvas\").getChildByName(\"game_root\");\r\n        this._gameObjects = [];\r\n\r\n        this._objectFactory = ObjectFactory.getInstance();\r\n        this._objectFactory.init();\r\n        this._inputMgr = InputManager.getInstance();\r\n        this._inputMgr.init();\r\n        this._gameTipMgr = GameTipManager.getInstance();\r\n        this._gameTipMgr.init();\r\n        this._mapMgr = MapManager.getInstance();\r\n        this._mapMgr.init();\r\n\r\n        this._mapMgr.enterMap(\"100001\");\r\n        console.log(\"GameManager初始化完成!\");\r\n    }\r\n\r\n    public get gameState() {\r\n        return this._gameState;\r\n    }\r\n\r\n    public get gameRoot() {\r\n        return this._gameRoot;\r\n    }\r\n\r\n    public pause() {\r\n        if (this._gameState != GameState.Ongoing) {\r\n            return;\r\n        }\r\n        this._gameState = GameState.Pause;\r\n    }\r\n\r\n    public unpause() {\r\n        if (this._gameState != GameState.Pause) {\r\n            return;\r\n        }\r\n        this._gameState = GameState.Ongoing;\r\n    }\r\n\r\n    public update(deltaTime: number) {\r\n        if (this._gameState == GameState.Ongoing) {\r\n            let curMousePos = this._inputMgr.mousePos;\r\n            let param: MouseParam = {\r\n                mousePos: curMousePos,\r\n            }\r\n            // 应该改成鼠标坐标变化时调用，而不是每一帧都调用\r\n            let hasShowTip = false;\r\n            for (let i = 0; i < this._gameObjects.length; i++) {\r\n                let object = this._gameObjects[i];\r\n                // console.log(object.contains(curMousePos))\r\n                if (object.contains(curMousePos)) {\r\n                    if (object != this._curDetectObject) {\r\n                        this._curDetectObject = object;\r\n                        this._gameTipMgr.showTip(object.getObjectParam().name, object.getTipData());\r\n                        this._gameTipMgr.moveTip(curMousePos);\r\n                        object.mouseOnObject(true, param);\r\n                    }\r\n                    else {\r\n                        this._gameTipMgr.moveTip(curMousePos);\r\n                    }\r\n                    hasShowTip = true;\r\n                    break;\r\n                }\r\n            }\r\n            // 在不需要显示提示并且上一帧有检测到物体（说明现在没检测到\r\n            if (!hasShowTip && this._curDetectObject) {\r\n                this._gameTipMgr.hideTip();\r\n                this._curDetectObject = null;\r\n            }\r\n\r\n        }\r\n        else {\r\n\r\n        }\r\n    }\r\n\r\n    public addObject(object: ObjectBase) {\r\n        this._gameObjects.push(object);\r\n    }\r\n\r\n    public removeObject(object: ObjectBase) {\r\n        //this._gameObjects.\r\n    }\r\n}\r\n\r\nexport interface MouseParam {\r\n    mousePos: Vec2,\r\n\r\n}\r\n\r\n"]}
{"version":3,"sources":["file:///D:/cocos_projects/physics_education_game/assets/scripts/manager/map_manager/MapData.ts"],"names":["MapData","_decorator","Singleton","LogManager","ResManager","LoadType","ccclass","property","constructor","inited","init","finishCb","mapDatas","getInstance","loadBundle","loadMapData","mapName","warn","mapData","loadAsset","JSON","json","err","error"],"mappings":";;;wIAyBqBA,O;;;;;;;;;;;;;;;;;;;;;;;;;;;AAxBZC,MAAAA,U,OAAAA,U;;AACAC,MAAAA,S,iBAAAA,S;;AACFC,MAAAA,U;;AACEC,MAAAA,U,iBAAAA,U;AAAYC,MAAAA,Q,iBAAAA,Q;;;;;;;;;OAGf;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;yBAkBTD,O,GAAN,MAAMA,OAAN;AAAA;AAAA,kCAAgC;AAI3CQ,QAAAA,WAAW,GAAG;AACV;AADU,eAHNC,MAGM,GAHY,KAGZ;AAEb;;AAEMC,QAAAA,IAAI,CAACC,QAAD,EAAwB;AAC/B,eAAKC,QAAL,GAAgB,EAAhB;AACA;AAAA;AAAA,wCAAWC,WAAX,GAAyBC,UAAzB,CAAoC,KAApC,EAA2C,MAAM;AAC7C,iBAAKL,MAAL,GAAc,IAAd;;AACA,gBAAIE,QAAJ,EAAc;AACVA,cAAAA,QAAQ;AACX;AACJ,WALD;AAMH;;AAEMI,QAAAA,WAAW,CAACC,OAAD,EAAkBL,QAAlB,EAA8D;AAC5E,cAAI,CAAC,KAAKD,IAAV,EAAgB;AACZ;AAAA;AAAA,0CAAWO,IAAX,CAAgB,gBAAhB;AACA;AACH;;AACD,cAAI,KAAKL,QAAL,CAAcI,OAAd,CAAJ,EAA4B;AACxB,gBAAIE,OAAO,GAAG,KAAKN,QAAL,CAAcI,OAAd,CAAd;AACAL,YAAAA,QAAQ,QAAR,YAAAA,QAAQ,CAAGO,OAAH,CAAR;AACH,WAHD,MAIK;AACD;AAAA;AAAA,0CAAWL,WAAX,GAAyBM,SAAzB,CAAmCH,OAAnC,EAA4C;AAAA;AAAA,sCAASI,IAArD,EAA2D,KAA3D,EAAmEC,IAAD,IAAqB;AACnF,kBAAIH,OAAO,GAAGG,IAAI,CAACA,IAAnB;AACA,mBAAKT,QAAL,CAAcI,OAAd,IAAyBE,OAAzB;AACAP,cAAAA,QAAQ,QAAR,YAAAA,QAAQ,CAAGO,OAAH,CAAR;AACH,aAJD,EAIII,GAAD,IAAS;AACR;AAAA;AAAA,4CAAWC,KAAX,CAAiBD,GAAjB;AACH,aAND;AAOH;AACJ;;AApC0C,O","sourcesContent":["\r\nimport { _decorator, JsonAsset } from \"cc\";\r\nimport { Singleton } from \"../../common/Singleton\";\r\nimport LogManager from \"../../utils/LogManager\";\r\nimport { ResManager, LoadType } from \"../ResManager\";\r\nimport { IPreInit } from \"../../common/IPreInit\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IOpenObjectData {\r\n    objectId: number,\r\n    name: string,\r\n    pos: string,\r\n    rot: string,\r\n    sca: string,\r\n    objectType: number,\r\n    shapeParam: any,\r\n    objectParam: any,\r\n}\r\n\r\nexport interface IOpenMapData {\r\n    mapId: number,\r\n    objectDatas: any,\r\n}\r\n\r\nexport default class MapData extends Singleton {\r\n    private inited: boolean = false;\r\n    private mapDatas: { [mapName: string]: IOpenMapData };\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    public init(finishCb?: () => void) {\r\n        this.mapDatas = {};\r\n        ResManager.getInstance().loadBundle(\"map\", () => {\r\n            this.inited = true;\r\n            if (finishCb) {\r\n                finishCb();\r\n            }\r\n        });\r\n    }\r\n\r\n    public loadMapData(mapName: string, finishCb?: (mapData: IOpenMapData) => void) {\r\n        if (!this.init) {\r\n            LogManager.warn(\"MapManager未初始化\");\r\n            return;\r\n        }\r\n        if (this.mapDatas[mapName]) {\r\n            let mapData = this.mapDatas[mapName];\r\n            finishCb?.(mapData);\r\n        }\r\n        else {\r\n            ResManager.getInstance().loadAsset(mapName, LoadType.JSON, \"map\", (json: JsonAsset) => {\r\n                let mapData = json.json as IOpenMapData;\r\n                this.mapDatas[mapName] = mapData;\r\n                finishCb?.(mapData);\r\n            }, (err) => {\r\n                LogManager.error(err);\r\n            });\r\n        }\r\n    }\r\n}"]}
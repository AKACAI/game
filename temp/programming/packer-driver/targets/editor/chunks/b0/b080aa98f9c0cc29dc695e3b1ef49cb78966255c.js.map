{"version":3,"sources":["file:///D:/cocos_projects/physics_education_game/assets/scripts/manager/ui_manager/UIManager.ts"],"names":["_decorator","director","instantiate","Singleton","ResManager","LoadType","ConstStr","UIPanel","ResDestroyType","ccclass","property","UILayer","UIManager","init","layer2node","Map","openingPanel","mainCanvas","getScene","getChildByName","node_game_view","children","forEach","node","index","set","nextInitManager","console","log","setNextInitManager","getLayerNode","layer","get","openPanel","panelName","finishCb","params","has","panelPath","PanelPath","bundleName","split","panelPrefabPath","getInstance","loadBundle","loadAsset","PrefableRes","prefab","uIPanel","getComponent","parent","setPosition","bindFunc","open","getPanel","closePanel","disbindFunc","close","resDestroyType","directlyRelease","releaseBundle","delayRelease"],"mappings":"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","sourcesContent":["import { _decorator, Vec3, director, instantiate, Node } from \"cc\";\r\nimport { Singleton } from \"../../common/Singleton\";\r\nimport { ResManager, LoadType } from \"../ResManager\";\r\nimport { ConstStr } from \"./Name2Panel\";\r\nimport { UIPanel, ResDestroyType } from \"./UIPanel\";\r\nimport { IPreInit } from \"../../common/IPreInit\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport enum UILayer {\r\n    mouse_input = 0,\r\n    game,\r\n    menu,\r\n    screen,\r\n    alert,\r\n}\r\n\r\ninterface IOpenable {\r\n    position?: Vec3,\r\n}\r\n\r\n@ccclass('UIManager')\r\nexport class UIManager extends Singleton implements IPreInit {\r\n    private mainCanvas: Node;\r\n    private layer2node: Map<UILayer, Node>;\r\n    private openingPanel: Map<string, UIPanel>;\r\n    public init() {\r\n        this.layer2node = new Map();\r\n        this.openingPanel = new Map();\r\n        this.mainCanvas = director.getScene().getChildByName(\"main_canvas\");\r\n\r\n        let node_game_view = this.mainCanvas.getChildByName(\"node_ui_view\");\r\n        node_game_view.children.forEach((node, index) => {\r\n            this.layer2node.set(index, node);\r\n        });\r\n\r\n        if (this.nextInitManager) {\r\n            this.nextInitManager.init();\r\n        }\r\n        console.log(\"UIManager初始化完成!\");\r\n    }\r\n\r\n    public nextInitManager: IPreInit;\r\n    public setNextInitManager(nextInitManager: IPreInit): void {\r\n        this.nextInitManager = nextInitManager;\r\n    }\r\n    public getLayerNode(layer: UILayer): Node {\r\n        return this.layer2node.get(layer);\r\n    }\r\n\r\n    public openPanel(panelName: string, finishCb?: () => void, params?: IOpenable) {\r\n        if (!panelName) {\r\n            return;\r\n        }\r\n        if (this.openingPanel.has(panelName)) {\r\n            return;\r\n        }\r\n        let panelPath = ConstStr.PanelPath[panelName];\r\n        let bundleName = panelPath.split(\"/\")[0];\r\n        let panelPrefabPath = panelPath.split(\"/\")[1];\r\n        ResManager.getInstance().loadBundle(bundleName, () => {\r\n            ResManager.getInstance().loadAsset(panelPrefabPath, LoadType.PrefableRes, bundleName, (prefab) => {\r\n                console.log(\"成功打开Panel：\", panelName);\r\n                let node = instantiate(prefab);\r\n                let uIPanel: UIPanel = node.getComponent(UIPanel);\r\n                node.parent = this.getLayerNode(uIPanel.layer);\r\n                node.setPosition(0, 0, 0);\r\n                this.openingPanel.set(panelName, uIPanel);\r\n                uIPanel.init();\r\n                uIPanel.bindFunc();\r\n                uIPanel.open();\r\n                finishCb?.();\r\n            });\r\n        });\r\n    }\r\n\r\n    public getPanel(panelName: string): UIPanel {\r\n        if (!panelName) {\r\n            return null;\r\n        }\r\n        if (!this.openingPanel.has(panelName)) {\r\n            return null;\r\n        }\r\n        let uIPanel = this.openingPanel.get(panelName);\r\n        return uIPanel;\r\n    }\r\n\r\n    public closePanel(panelName: string) {\r\n        if (!panelName) {\r\n            return;\r\n        }\r\n        if (!this.openingPanel.has(panelName)) {\r\n            return;\r\n        }\r\n        let uIPanel = this.openingPanel.get(panelName);\r\n        let node = uIPanel.node;\r\n        uIPanel.disbindFunc();\r\n        uIPanel.close();\r\n\r\n        if (uIPanel.resDestroyType == ResDestroyType.directlyRelease) {\r\n            let panelPath = ConstStr.PanelPath[panelName];\r\n            let bundleName = panelPath.split(\"/\")[0];\r\n            ResManager.getInstance().releaseBundle(bundleName);\r\n        }\r\n        else if (uIPanel.resDestroyType == ResDestroyType.delayRelease) {\r\n\r\n        }\r\n        else {\r\n\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}
{"version":3,"sources":["file:///E:/education_game/game/assets/scripts/modules/ui/game_tip/GameTipView.ts"],"names":["_decorator","Label","UITransform","instantiate","ResManager","LoadType","UILayer","UIPanel","GameTipItem","ccclass","property","GameTipView","itemCreateCount","init","_layer","game","bg_tip","node","getChildByName","lb_name","getComponent","node_tips","getInstance","loadAsset","PrefableRes","prefab","itemPrefab","i","createTip","open","close","dispose","destroyTips","showTip","name","data","active","length","tipsData","string","node_height","curPosY","maxShowCount","Math","min","children","curTipNode","curTipItemCpt","setData","setPosition","item_height","contentSize","y","node_width","x","setContentSize","hideTips","tipItemCpt","addChild","item","destroy"],"mappings":"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","sourcesContent":["import { _decorator, Label, Prefab, UITransform, instantiate, Node } from \"cc\";\nimport { ResManager, LoadType } from \"../../../manager/ResManager\";\nimport { UILayer } from \"../../../manager/ui_manager/UIManager\";\nimport { UIPanel } from \"../../../manager/ui_manager/UIPanel\";\nimport { GameTipData, GameTipItem } from \"./GameTipItem\";\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('GameTipView')\nexport class GameTipView extends UIPanel {\n    private tipsData: GameTipData[];\n\n    private lb_name: Label;\n    private bg_tip: Node;\n    private node_tips: Node;\n    private itemPrefab: Prefab;\n    private readonly itemCreateCount = 5;\n\n    public init() {\n        this._layer = UILayer.game;\n        this.bg_tip = this.node.getChildByName(\"bg_tip\");\n        this.lb_name = this.node.getChildByName(\"lb_name\").getComponent(Label);\n        this.node_tips = this.node.getChildByName(\"node_tips\");\n        ResManager.getInstance().loadAsset(\"game_tip_item\", LoadType.PrefableRes, \"game_tip\", (prefab) => {\n            this.itemPrefab = prefab;\n            for (let i = 0; i < this.itemCreateCount; i++) {\n                this.createTip()\n            }\n        }, null, this);\n    }\n\n    public open() {\n\n    }\n\n    public close() {\n\n    }\n\n    public dispose() {\n        this.destroyTips();\n    }\n\n    public showTip(name?: string, data?: GameTipData[]) {\n        this.node.active = true;\n        if (!data || data.length == 0) {\n            this.node_tips.active = false;\n            return;\n        }\n        this.node_tips.active = true;\n        this.tipsData = data;\n        this.lb_name.string = name;\n        let node_height = 45;\n\n        let curPosY = 0;\n        let maxShowCount = Math.min(data.length, this.node_tips.children.length);\n        for (let i = 0; i < maxShowCount; i++) {\n            let curTipNode = this.node_tips.children[i];\n            let curTipItemCpt = curTipNode.getComponent(GameTipItem);\n            if (curTipItemCpt) {\n                curTipItemCpt.setData(data[i]);\n                curTipNode.setPosition(0, curPosY, 0);\n                curTipNode.active = true;\n                let item_height = curTipItemCpt.getComponent(UITransform).contentSize.y;\n                curPosY -= item_height;\n                node_height += item_height;\n            }\n        }\n        for (let i = maxShowCount; i < this.node_tips.children.length; i++) {\n            this.node_tips.children[i].active = false;\n        }\n        let node_width = this.node.getComponent(UITransform).contentSize.x;\n        this.node.getComponent(UITransform).setContentSize(node_width, node_height);\n        this.bg_tip.getComponent(UITransform).setContentSize(node_width, node_height);\n    }\n\n    public hideTips() {\n        this.node.active = false;\n    }\n\n    private createTip(): Node {\n        let node = instantiate(this.itemPrefab);\n        let tipItemCpt = node.getComponent(GameTipItem);\n        if (tipItemCpt) {\n            tipItemCpt.init();\n            this.node_tips.addChild(node);\n            node.active = false;\n            return node;\n        }\n        return null;\n    }\n\n    private destroyTips() {\n        for (let i = this.node_tips.children.length - 1; i >= 0; i++) {\n            let item = this.node.children[i];\n            item.destroy();\n        }\n    }\n}"]}
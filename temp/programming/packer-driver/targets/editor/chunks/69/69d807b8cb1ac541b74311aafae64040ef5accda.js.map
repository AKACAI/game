{"version":3,"sources":["file:///D:/cocos_projects/physics_education_game/assets/scripts/modules/ui/game_start_ui/LevelSelectView.ts"],"names":["_decorator","instantiate","tween","Vec3","UIPanel","UILayer","LogManager","NodeHelper","LoadType","ResManager","LevelSelectModeItem","Display","ccclass","property","LevelSelectView","node_center","undefined","node_mode_items","btn_close","btn_tip","node_block_click_mask","node_level_items","modeItems","levelItems","status","modeItemPath","levelItemPath","modeItemPrefab","levelItemPrefab","tweenShowAnimData","animTime","init","_layer","normal","getInstance","loadAsset","PrefableRes","bundleName","prefab","node","getChildByName","setNodeSizeFullScreen","addListener","open","LevelSelectViewStatus","origin","initItemUI","active","setNodeClickEvent","closeBySelf","modeData","name","bg_path","clickCb","showOneMode","error","panelName","screenWidth","getWindowSize","x","spacingWithSceenX","spacingX","length","startPosX","i","addChild","setPosX","itemCpt","getComponent","setData","push","index","showAnim","order","item","setSiblingIndex","to","position","scale","call","idle","start","close","dispose"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Node, Prefab, tween, UIOpacity, Vec2, Vec3 } from \"cc\";\nimport { UIPanel } from \"../../../manager/ui_manager/UIPanel\";\nimport { UILayer } from \"../../../manager/ui_manager/UIManager\";\nimport { GameManager, GameState } from \"../../../manager/game_manager/GameManager\";\nimport LogManager from \"../../../utils/LogManager\";\nimport NodeHelper from \"../../../common/NodeHelper\";\nimport { LoadType, ResManager } from \"../../../manager/ResManager\";\nimport { ISetDataModeItem, LevelSelectModeItem } from \"./LevelSelectModeItem\";\nimport { Display } from \"../../../common/Display\";\nimport { LevelItem } from \"./LevelItem\";\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('LevelSelectView')\nexport class LevelSelectView extends UIPanel {\n    private node_center: Node = undefined;\n    private node_mode_items: Node = undefined;\n\n    private btn_close: Node = undefined;\n    private btn_tip: Node = undefined;\n    private node_block_click_mask: Node = undefined;\n\n    private node_level_items: Node = undefined;\n\n    private modeItems: LevelSelectModeItem[] = undefined;\n    private levelItems: LevelItem[] = undefined;\n\n    private status: LevelSelectViewStatus = undefined;\n    private readonly modeItemPath: string = \"level_select_mode_item\";\n    private readonly levelItemPath: string = \"level_item\";\n    private modeItemPrefab: Prefab = undefined;\n    private levelItemPrefab: Prefab = undefined;\n    private readonly tweenShowAnimData = {\n        animTime: 0.7,\n    }\n    public init() {\n        super.init();\n        this._layer = UILayer.normal;\n\n        ResManager.getInstance().loadAsset(this.modeItemPath, LoadType.PrefableRes, this.bundleName, (prefab: Prefab) => {\n            this.modeItemPrefab = prefab;\n        });\n\n        ResManager.getInstance().loadAsset(this.levelItemPath, LoadType.PrefableRes, this.bundleName, (prefab: Prefab) => {\n            this.levelItemPrefab = prefab;\n        });\n\n        this.node_center = this.node.getChildByName(\"node_center\");\n        this.node_mode_items = this.node_center.getChildByName(\"node_mode_items\");\n        this.btn_close = this.node_center.getChildByName(\"btn_close\");\n        this.btn_tip = this.node_center.getChildByName(\"btn_tip\");\n        this.node_block_click_mask = this.node_center.getChildByName(\"node_block_click_mask\");\n        this.node_level_items = this.node_center.getChildByName(\"node_level_items\");\n        NodeHelper.setNodeSizeFullScreen(this.node_block_click_mask);\n        this.addListener();\n    }\n\n    public open() {\n        super.open();\n\n        this.status = LevelSelectViewStatus.origin;\n        this.initItemUI();\n        this.node_block_click_mask.active = false;\n    }\n\n    private addListener() {\n        NodeHelper.setNodeClickEvent(this.btn_close, () => {\n            this.closeBySelf();\n        }, this);\n\n        NodeHelper.setNodeClickEvent(this.btn_tip, () => {\n\n        }, this);\n    }\n\n    private initItemUI() {\n        this.modeItems = [];\n        let modeData: ISetDataModeItem[] = [{\n            name: \"保卫小车\",\n            bg_path: \"\",\n            clickCb: () => {\n                this.showOneMode(0);\n            },\n        }, {\n            name: \"保卫小车2\",\n            bg_path: \"\",\n            clickCb: () => {\n                this.showOneMode(1);\n            },\n        }, {\n            name: \"保卫小车3\",\n            bg_path: \"\",\n            clickCb: () => {\n                this.showOneMode(2);\n            },\n        }]\n        if (!this.node_mode_items || !this.modeItems) {\n            LogManager.error(this.panelName, \"已经正在销毁了！！\");\n            return;\n        }\n        let screenWidth: number = Display.getInstance().getWindowSize().x;\n        let spacingWithSceenX: number = 200;\n        let spacingX: number = (screenWidth - spacingWithSceenX * 2) / (modeData.length - 1);\n        let startPosX: number = -(screenWidth - spacingWithSceenX * 2) / 2;\n        for (let i = 0; i < modeData.length; i++) {\n            let node = instantiate(this.modeItemPrefab);\n            this.node_mode_items.addChild(node);\n            NodeHelper.setPosX(node, startPosX + spacingX * i);\n            let itemCpt: LevelSelectModeItem = node.getComponent(LevelSelectModeItem);\n            if (itemCpt) {\n                itemCpt.init();\n                itemCpt.setData(modeData[i]);\n            }\n            this.modeItems.push(itemCpt);\n        }\n    }\n\n    private showOneMode(index: number) {\n        if (index >= this.modeItems.length) {\n            return;\n        }\n        if (this.status != LevelSelectViewStatus.origin) {\n            return;\n        }\n        this.status = LevelSelectViewStatus.showAnim;\n        this.node_block_click_mask.active = true;\n        let order: number = 1;      // 用来标记当前是第几个小模式\n        for (let i = 0; i < this.modeItems.length; i++) {\n            const item = this.modeItems[i];\n            if (i == index) {\n                item.node.setSiblingIndex(this.modeItems.length - 1);\n                tween(item.node)\n                    .to(this.tweenShowAnimData.animTime, { position: new Vec3(-300, -40), scale: new Vec3(1.2, 1.2, 1) })\n                    .call(() => {\n                        this.status = LevelSelectViewStatus.idle;\n                        this.node_block_click_mask.active = false;\n                    })\n                    .start();\n            } else {\n                item.node.setSiblingIndex(this.modeItems.length - 1 - order);\n                tween(item.node)\n                    .to(this.tweenShowAnimData.animTime * 0.8, { position: new Vec3(-320 - 30 * order, -60), scale: new Vec3(1, 1, 1) }, {})\n                    .call(() => {\n\n                    })\n                    .start();\n                order++;\n            }\n        }\n    }\n\n    public close() {\n        super.close();\n    }\n\n    public dispose() {\n        super.dispose();\n        if (this.modeItems) {\n            for (let i = 0; i < this.modeItems.length; i++) {\n                this.modeItems[i]?.dispose();\n            }\n        }\n    }\n}\n\nenum LevelSelectViewStatus {\n    origin = 1,     // 初始状态\n    showAnim = 2,   // 聚拢动画中\n    idle = 3,       // 聚拢后静态\n    rotateAnim = 4, // 旋转动画中\n}"]}
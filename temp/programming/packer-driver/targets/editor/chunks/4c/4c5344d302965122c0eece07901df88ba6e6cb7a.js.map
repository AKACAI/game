{"version":3,"sources":["file:///D:/cocos_projects/physics_education_game/assets/scripts/manager/game_manager/GameManager.ts"],"names":["_decorator","director","PhysicsSystem2D","game","Game","Singleton","GameTipManager","InputManager","MapManager","ccclass","timeScale","_calculateDT","now","performance","_deltaTime","_startTime","DEBUG_DT_THRESHOLD","frameTime","GameState","GameManager","init","_gameState","NotInGame","_gameRoot","getScene","getChildByName","_gameObjects","console","log","nextInitManager","setNextInitManager","gameState","gameRoot","start","Ongoing","instance","enable","getInstance","enterMap","setTimeScale","value","pause","Pause","resume","update","deltaTime","curMousePos","mousePos","param","hasShowTip","i","length","object","contains","_curDetectObject","showTip","getObjectParam","name","getTipData","moveTip","mouseOnObject","hideTip","addObject","push","removeObject"],"mappings":"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","sourcesContent":["import { _decorator, director, Vec2, Node, PhysicsSystem2D, game, Game } from \"cc\";\nimport { Singleton } from \"../../common/Singleton\";\nimport { ObjectBase } from \"../../modules/game/ObjectBase\";\nimport { GameTipManager } from \"../../modules/ui/game_tip/GameTipManager\";\nimport { InputManager } from \"../InputManager\";\nimport { MapManager } from \"../map_manager/MapManager\";\nimport { IPreInit } from \"../../common/IPreInit\";\nconst { ccclass } = _decorator;\n\nlet timeScale = 1;\n//@ts-ignore\ngame._calculateDT = function (now: number) {\n    if (!now) now = performance.now();\n    this._deltaTime = now > this._startTime ? (now - this._startTime) / 1000 : 0;\n    if (this._deltaTime > Game.DEBUG_DT_THRESHOLD) {\n        this._deltaTime = this.frameTime / 1000;\n    }\n    this._startTime = now;\n    return this._deltaTime * timeScale;\n};\n\nexport enum GameState {\n    NotInGame,\n    Pause,\n    Ongoing,\n}\n\n\n@ccclass('GameManager')\nexport class GameManager extends Singleton {\n    private _gameState: GameState;\n\n    // 应该引入一个ObjectManager的东西\n    private _gameRoot: Node;\n    // private _gameObjects: ObjectBase[][];   // 物体的输入有优先级的区分，0级为最优先，依次递减\n    private _gameObjects: ObjectBase[];\n    private _curDetectObject: ObjectBase;       // 当前鼠标检测到的物体\n\n    public init() {\n        this._gameState = GameState.NotInGame;\n        this._gameRoot = director.getScene().getChildByName(\"main_canvas\").getChildByName(\"game_root\");\n        this._gameObjects = [];\n\n        console.log(\"GameManager初始化完成!\");\n        if (this.nextInitManager) {\n            this.nextInitManager.init();\n        }\n    }\n\n    public nextInitManager: IPreInit;\n    public setNextInitManager(nextInitManager: IPreInit): void {\n        this.nextInitManager = nextInitManager;\n    }\n\n    public get gameState() {\n        return this._gameState;\n    }\n\n    public get gameRoot() {\n        return this._gameRoot;\n    }\n\n    public start() {\n        this._gameState = GameState.Ongoing;\n        timeScale = 1;\n        PhysicsSystem2D.instance.enable = true;\n        MapManager.getInstance().enterMap(\"100001\");\n    }\n\n    public setTimeScale(value) {\n        timeScale = value < 0 ? 0 : value > 2 ? 2 : value;\n    }\n\n    public pause() {\n        if (this._gameState != GameState.Ongoing) {\n            return;\n        }\n        // for (let i = 0; i < this._gameObjects.length; i++) {\n        //     const object = this._gameObjects[i];\n        //     if (!object) {\n        //         continue;\n        //     }\n        //     object.pause();\n        // }\n        timeScale = 0;\n        this._gameState = GameState.Pause;\n    }\n\n    public resume() {\n        if (this._gameState != GameState.Pause) {\n            return;\n        }\n        // for (let i = 0; i < this._gameObjects.length; i++) {\n        //     const object = this._gameObjects[i];\n        //     if (!object) {\n        //         continue;\n        //     }\n        //     object.resume();\n        // }\n        timeScale = 1;\n        this._gameState = GameState.Ongoing;\n    }\n\n    public update(deltaTime: number) {\n        let curMousePos = InputManager.getInstance().mousePos;\n        let param: MouseParam = {\n            mousePos: curMousePos,\n        }\n        // 应该改成鼠标坐标变化时调用，而不是每一帧都调用\n        let hasShowTip = false;\n        for (let i = 0; i < this._gameObjects.length; i++) {\n            let object = this._gameObjects[i];\n            // console.log(object.contains(curMousePos))\n            if (object.contains(curMousePos)) {\n                if (object != this._curDetectObject) {\n                    this._curDetectObject = object;\n                    GameTipManager.getInstance().showTip(object.getObjectParam().name, object.getTipData());\n                    GameTipManager.getInstance().moveTip(curMousePos);\n                    object.mouseOnObject(true, param);\n                }\n                else {\n                    GameTipManager.getInstance().moveTip(curMousePos);\n                }\n                hasShowTip = true;\n                break;\n            }\n        }\n        // 在不需要显示提示并且上一帧有检测到物体（说明现在没检测到\n        if (!hasShowTip && this._curDetectObject) {\n            GameTipManager.getInstance().hideTip();\n            this._curDetectObject = null;\n        }\n    }\n\n    public addObject(object: ObjectBase) {\n        this._gameObjects.push(object);\n    }\n\n    public removeObject(object: ObjectBase) {\n        //this._gameObjects.\n    }\n}\n\nexport interface MouseParam {\n    mousePos: Vec2,\n\n}\n\n"]}
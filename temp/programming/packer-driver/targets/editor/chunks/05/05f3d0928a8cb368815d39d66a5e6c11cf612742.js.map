{"version":3,"sources":["file:///E:/education_game/game/assets/scripts/manager/game_manager/InteractSpace.ts"],"names":["_decorator","Vec2","Vec3","v2","ccclass","property","InteractSpace","constructor","objectBase","forceId","localVertices","getLocalVertices","contains","pointPos","crossings","nodePos","node","getWorldPosition","vertices","forEach","vertex","rotation","getEulerAngles","angle","Math","PI","z","x","cos","y","sin","push","i","length","curPos","nextPos","slope","cond1","cond2","above","onMouseEnterSpace","param","addForce","onMouseLeaveSpace","removeForce"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec2, Vec3, v2 } from 'cc';\r\nimport { ObjectBase } from '../../modules/game/ObjectBase';\r\nimport { MouseParam } from '../InputManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('InteractSpace')\r\nexport class InteractSpace {\r\n    private objectBase: ObjectBase;\r\n\r\n    private localVertices: Vec2[];\r\n\r\n    constructor(objectBase: ObjectBase) {\r\n        this.objectBase = objectBase;\r\n        this.localVertices = objectBase.getLocalVertices();\r\n    }\r\n\r\n    // 碰撞体内是否包含点\r\n    // https://blog.csdn.net/zsjzliziyang/article/details/108813349\r\n    public contains(pointPos: Vec2): boolean {\r\n        let crossings = 0;\r\n\r\n        let nodePos = this.objectBase.node.getWorldPosition();\r\n        let vertices = [];\r\n        if (this.localVertices) {\r\n            this.localVertices.forEach(vertex => {\r\n                let rotation: Vec3 = new Vec3();\r\n                this.objectBase.node.rotation.getEulerAngles(rotation);\r\n                let angle = -Math.PI * rotation.z / 180;\r\n                let x = vertex.x * Math.cos(angle) + vertex.y * Math.sin(angle);\r\n                let y = -vertex.x * Math.sin(angle) + vertex.y * Math.cos(angle);\r\n                vertices.push(new Vec2(x + nodePos.x, y + nodePos.y));\r\n            })\r\n        }\r\n        for (let i = 0; i < vertices.length; i++) {\r\n            let curPos = vertices[i];\r\n            let nextPos = (i + 1 == vertices.length) ? vertices[0] : vertices[i + 1];\r\n            let slope = (nextPos.y - curPos.y) / (nextPos.x - curPos.x);\r\n            let cond1 = (curPos.x <= pointPos.x) && (nextPos.x > pointPos.x);\r\n            let cond2 = (nextPos.x <= pointPos.x) && (curPos.x > pointPos.x);\r\n            let above = (pointPos.y < slope * (pointPos.x - curPos.x) + curPos.y);\r\n            if ((cond1 || cond2) && above) {\r\n                crossings++;\r\n            }\r\n        }\r\n        return (crossings % 2 != 0);\r\n    }\r\n\r\n    private forceId = 0;\r\n    public onMouseEnterSpace(param: MouseParam) {\r\n        this.forceId = this.objectBase.addForce(v2(10, 0));\r\n    }\r\n\r\n    public onMouseLeaveSpace(param: MouseParam) {\r\n        this.objectBase.removeForce(this.forceId);\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}
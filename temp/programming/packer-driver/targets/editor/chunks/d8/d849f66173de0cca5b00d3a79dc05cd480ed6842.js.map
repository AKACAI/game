{"version":3,"sources":["file:///E:/education_game/game/assets/scripts/manager/map_manager/MapManager.ts"],"names":["_decorator","Singleton","ObjectFactory","Utils","GameManager","MapData","EventManager","EventConstants","ObjectVisualTag","ccclass","property","MapManager","init","gameMgr","getInstance","map_root","gameRoot","getChildByName","nextInitManager","dispatchEvent","GameControl","GameStart","setNextInitManager","enterMap","mapName","loadMapData","mapData","i","objectDatas","length","data","object","getObject","objectType","objectId","shapeParam","str2vec3","pos","objectParam","physicsParam","addObject","front"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,a,iBAAAA,a;;AACFC,MAAAA,K;;AACEC,MAAAA,W,iBAAAA,W;;AACFC,MAAAA,O;;AAEAC,MAAAA,Y;;AACEC,MAAAA,c,iBAAAA,c;;AACAC,MAAAA,e,iBAAAA,e;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;4BAGjBW,U,WADZF,OAAO,CAAC,YAAD,C,gBAAR,MACaE,UADb;AAAA;AAAA,kCAC8D;AAGnDC,QAAAA,IAAI,GAAG;AACV,eAAKC,OAAL,GAAe;AAAA;AAAA,0CAAYC,WAAZ,EAAf;AACA,eAAKC,QAAL,GAAgB,KAAKF,OAAL,CAAaG,QAAb,CAAsBC,cAAtB,CAAqC,UAArC,CAAhB;AACA;AAAA;AAAA,kCAAQH,WAAR,GAAsBF,IAAtB,CAA2B,MAAM;AAC7B,gBAAI,KAAKM,eAAT,EAA0B;AACtB,mBAAKA,eAAL,CAAqBN,IAArB;AACH,aAFD,MAEO;AACH;AAAA;AAAA,gDAAaO,aAAb,CAA2B;AAAA;AAAA,oDAAeC,WAAf,CAA2BC,SAAtD;AACH;AACJ,WAND;AAOH;;AAGMC,QAAAA,kBAAkB,CAACJ,eAAD,EAAkC;AACvD,eAAKA,eAAL,GAAuBA,eAAvB;AACH;;AAEMK,QAAAA,QAAQ,CAACC,OAAD,EAAkB;AAC7B;AAAA;AAAA,kCAAQV,WAAR,GAAsBW,WAAtB,CAAkCD,OAAlC,EAA4CE,OAAD,IAAa;AACpD,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,OAAO,CAACE,WAAR,CAAoBC,MAAxC,EAAgDF,CAAC,EAAjD,EAAqD;AACjD,kBAAIG,IAAI,GAAGJ,OAAO,CAACE,WAAR,CAAoBD,CAApB,CAAX;AACA,kBAAII,MAAM,GAAG;AAAA;AAAA,kDAAcjB,WAAd,GAA4BkB,SAA5B,CAAsCF,IAAI,CAACG,UAA3C,EAAuDH,IAAI,CAACI,QAA5D,EAAsEJ,IAAI,CAACK,UAA3E,EAAuF;AAAA;AAAA,kCAAMC,QAAN,CAAeN,IAAI,CAACO,GAApB,CAAvF,EAAiHP,IAAI,CAACQ,WAAtH,EAAmIR,IAAI,CAACS,YAAxI,EAAsJ,KAAKxB,QAA3J,CAAb;AACA,mBAAKF,OAAL,CAAa2B,SAAb,CAAuBT,MAAvB,EAA+B;AAAA;AAAA,sDAAgBU,KAA/C;AACH;AACJ,WAND;AAOH;;AA5ByD,O","sourcesContent":["import { _decorator, Node } from \"cc\";\nimport { Singleton } from \"../../common/Singleton\";\nimport { ObjectFactory } from \"../../modules/game/ObjectFactory\";\nimport Utils from \"../../utils/Utils\";\nimport { GameManager } from \"../game_manager/GameManager\";\nimport MapData, { IOpenObjectData } from \"./MapData\";\nimport { IPreInit } from \"../../common/IPreInit\";\nimport EventManager from \"../event_manager/EventManager\";\nimport { EventConstants } from \"../event_manager/EventConstants\";\nimport { ObjectVisualTag } from \"../../modules/game/ObjectBase\";\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('MapManager')\nexport class MapManager extends Singleton implements IPreInit {\n    private map_root: Node;\n    private gameMgr: GameManager;\n    public init() {\n        this.gameMgr = GameManager.getInstance();\n        this.map_root = this.gameMgr.gameRoot.getChildByName(\"map_root\");\n        MapData.getInstance().init(() => {\n            if (this.nextInitManager) {\n                this.nextInitManager.init();\n            } else {\n                EventManager.dispatchEvent(EventConstants.GameControl.GameStart);\n            }\n        });\n    }\n\n    public nextInitManager: IPreInit;\n    public setNextInitManager(nextInitManager: IPreInit): void {\n        this.nextInitManager = nextInitManager;\n    }\n\n    public enterMap(mapName: string) {\n        MapData.getInstance().loadMapData(mapName, (mapData) => {\n            for (let i = 0; i < mapData.objectDatas.length; i++) {\n                let data = mapData.objectDatas[i] as IOpenObjectData;\n                let object = ObjectFactory.getInstance().getObject(data.objectType, data.objectId, data.shapeParam, Utils.str2vec3(data.pos), data.objectParam, data.physicsParam, this.map_root);\n                this.gameMgr.addObject(object, ObjectVisualTag.front);\n            }\n        });\n    }\n}\n\n\n"]}
{"version":3,"sources":["file:///D:/cocos_projects/physics_education_game/assets/scripts/manager/game_manager/GameManager.ts"],"names":["_decorator","director","Singleton","GameTipManager","InputManager","MapManager","ccclass","GameState","GameManager","init","_gameState","Ongoing","_gameRoot","getScene","getChildByName","_gameObjects","console","log","nextInitManager","setNextInitManager","gameState","gameRoot","start","getC","getInstance","enterMap","pause","i","length","object","Pause","resume","update","deltaTime","curMousePos","mousePos","param","hasShowTip","contains","_curDetectObject","showTip","getObjectParam","name","getTipData","moveTip","mouseOnObject","hideTip","addObject","push","removeObject"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,Q,OAAAA,Q;;AACZC,MAAAA,S,iBAAAA,S;;AAGAC,MAAAA,c,iBAAAA,c;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,U,iBAAAA,U;;;;;;;;;OAIH;AAAEC,QAAAA;AAAF,O,GAAcN,U;;2BAERO,S,0BAAAA,S;AAAAA,QAAAA,S,CAAAA,S;AAAAA,QAAAA,S,CAAAA,S;AAAAA,QAAAA,S,CAAAA,S;eAAAA,S;;;6BAQCC,W,WADZF,OAAO,CAAC,aAAD,C,gBAAR,MACaE,WADb;AAAA;AAAA,kCAC2C;AAGvC;AAEA;AAE4C;AAErCC,QAAAA,IAAI,GAAG;AACV,eAAKC,UAAL,GAAkBH,SAAS,CAACI,OAA5B;AACA,eAAKC,SAAL,GAAiBX,QAAQ,CAACY,QAAT,GAAoBC,cAApB,CAAmC,aAAnC,EAAkDA,cAAlD,CAAiE,WAAjE,CAAjB;AACA,eAAKC,YAAL,GAAoB,EAApB;AAEAC,UAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;;AACA,cAAI,KAAKC,eAAT,EAA0B;AACtB,iBAAKA,eAAL,CAAqBT,IAArB;AACH;AACJ;;AAGMU,QAAAA,kBAAkB,CAACD,eAAD,EAAkC;AACvD,eAAKA,eAAL,GAAuBA,eAAvB;AACH;;AAEmB,YAATE,SAAS,GAAG;AACnB,iBAAO,KAAKV,UAAZ;AACH;;AAEkB,YAARW,QAAQ,GAAG;AAClB,iBAAO,KAAKT,SAAZ;AACH;;AAEMU,QAAAA,KAAK,GAAG;AACX,eAAKZ,UAAL,GAAkBH,SAAS,CAACI,OAA5B;AACAV,UAAAA,QAAQ,CAACsB,IAAT;AACA;AAAA;AAAA,wCAAWC,WAAX,GAAyBC,QAAzB,CAAkC,QAAlC;AACH;;AAEMC,QAAAA,KAAK,GAAG;AACX,cAAI,KAAKhB,UAAL,IAAmBH,SAAS,CAACI,OAAjC,EAA0C;AACtC;AACH;;AACD,eAAK,IAAIgB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKZ,YAAL,CAAkBa,MAAtC,EAA8CD,CAAC,EAA/C,EAAmD;AAC/C,kBAAME,MAAM,GAAG,KAAKd,YAAL,CAAkBY,CAAlB,CAAf;;AACA,gBAAI,CAACE,MAAL,EAAa;AACT;AACH;;AACDA,YAAAA,MAAM,CAACH,KAAP;AACH;;AACD,eAAKhB,UAAL,GAAkBH,SAAS,CAACuB,KAA5B;AACH;;AAEMC,QAAAA,MAAM,GAAG;AACZ,cAAI,KAAKrB,UAAL,IAAmBH,SAAS,CAACuB,KAAjC,EAAwC;AACpC;AACH;;AACD,eAAK,IAAIH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKZ,YAAL,CAAkBa,MAAtC,EAA8CD,CAAC,EAA/C,EAAmD;AAC/C,kBAAME,MAAM,GAAG,KAAKd,YAAL,CAAkBY,CAAlB,CAAf;;AACA,gBAAI,CAACE,MAAL,EAAa;AACT;AACH;;AACDA,YAAAA,MAAM,CAACE,MAAP;AACH;;AACD,eAAKrB,UAAL,GAAkBH,SAAS,CAACI,OAA5B;AACH;;AAEMqB,QAAAA,MAAM,CAACC,SAAD,EAAoB;AAC7B,cAAIC,WAAW,GAAG;AAAA;AAAA,4CAAaV,WAAb,GAA2BW,QAA7C;AACA,cAAIC,KAAiB,GAAG;AACpBD,YAAAA,QAAQ,EAAED;AADU,WAAxB,CAF6B,CAK7B;;AACA,cAAIG,UAAU,GAAG,KAAjB;;AACA,eAAK,IAAIV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKZ,YAAL,CAAkBa,MAAtC,EAA8CD,CAAC,EAA/C,EAAmD;AAC/C,gBAAIE,MAAM,GAAG,KAAKd,YAAL,CAAkBY,CAAlB,CAAb,CAD+C,CAE/C;;AACA,gBAAIE,MAAM,CAACS,QAAP,CAAgBJ,WAAhB,CAAJ,EAAkC;AAC9B,kBAAIL,MAAM,IAAI,KAAKU,gBAAnB,EAAqC;AACjC,qBAAKA,gBAAL,GAAwBV,MAAxB;AACA;AAAA;AAAA,sDAAeL,WAAf,GAA6BgB,OAA7B,CAAqCX,MAAM,CAACY,cAAP,GAAwBC,IAA7D,EAAmEb,MAAM,CAACc,UAAP,EAAnE;AACA;AAAA;AAAA,sDAAenB,WAAf,GAA6BoB,OAA7B,CAAqCV,WAArC;AACAL,gBAAAA,MAAM,CAACgB,aAAP,CAAqB,IAArB,EAA2BT,KAA3B;AACH,eALD,MAMK;AACD;AAAA;AAAA,sDAAeZ,WAAf,GAA6BoB,OAA7B,CAAqCV,WAArC;AACH;;AACDG,cAAAA,UAAU,GAAG,IAAb;AACA;AACH;AACJ,WAvB4B,CAwB7B;;;AACA,cAAI,CAACA,UAAD,IAAe,KAAKE,gBAAxB,EAA0C;AACtC;AAAA;AAAA,kDAAef,WAAf,GAA6BsB,OAA7B;AACA,iBAAKP,gBAAL,GAAwB,IAAxB;AACH;AACJ;;AAEMQ,QAAAA,SAAS,CAAClB,MAAD,EAAqB;AACjC,eAAKd,YAAL,CAAkBiC,IAAlB,CAAuBnB,MAAvB;AACH;;AAEMoB,QAAAA,YAAY,CAACpB,MAAD,EAAqB,CACpC;AACH;;AAxGsC,O","sourcesContent":["import { _decorator, director, Vec2, Node } from \"cc\";\r\nimport { Singleton } from \"../../common/Singleton\";\r\nimport { ObjectBase } from \"../../modules/game/ObjectBase\";\r\nimport { ObjectFactory } from \"../../modules/game/ObjectFactory\";\r\nimport { GameTipManager } from \"../../modules/ui/game_tip/GameTipManager\";\r\nimport { InputManager } from \"../InputManager\";\r\nimport { MapManager } from \"../map_manager/MapManager\";\r\nimport { IPreInit } from \"../../common/IPreInit\";\r\nimport { UIManager } from \"../ui_manager/UIManager\";\r\n\r\nconst { ccclass } = _decorator;\r\n\r\nexport enum GameState {\r\n    NotInGame,\r\n    Pause,\r\n    Ongoing,\r\n}\r\n\r\n\r\n@ccclass('GameManager')\r\nexport class GameManager extends Singleton {\r\n    private _gameState: GameState;\r\n\r\n    // 应该引入一个ObjectManager的东西\r\n    private _gameRoot: Node;\r\n    // private _gameObjects: ObjectBase[][];   // 物体的输入有优先级的区分，0级为最优先，依次递减\r\n    private _gameObjects: ObjectBase[];\r\n    private _curDetectObject: ObjectBase;       // 当前鼠标检测到的物体\r\n\r\n    public init() {\r\n        this._gameState = GameState.Ongoing;\r\n        this._gameRoot = director.getScene().getChildByName(\"main_canvas\").getChildByName(\"game_root\");\r\n        this._gameObjects = [];\r\n\r\n        console.log(\"GameManager初始化完成!\");\r\n        if (this.nextInitManager) {\r\n            this.nextInitManager.init();\r\n        }\r\n    }\r\n\r\n    public nextInitManager: IPreInit;\r\n    public setNextInitManager(nextInitManager: IPreInit): void {\r\n        this.nextInitManager = nextInitManager;\r\n    }\r\n\r\n    public get gameState() {\r\n        return this._gameState;\r\n    }\r\n\r\n    public get gameRoot() {\r\n        return this._gameRoot;\r\n    }\r\n\r\n    public start() {\r\n        this._gameState = GameState.Ongoing;\r\n        director.getC\r\n        MapManager.getInstance().enterMap(\"100001\");\r\n    }\r\n\r\n    public pause() {\r\n        if (this._gameState != GameState.Ongoing) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < this._gameObjects.length; i++) {\r\n            const object = this._gameObjects[i];\r\n            if (!object) {\r\n                continue;\r\n            }\r\n            object.pause();\r\n        }\r\n        this._gameState = GameState.Pause;\r\n    }\r\n\r\n    public resume() {\r\n        if (this._gameState != GameState.Pause) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < this._gameObjects.length; i++) {\r\n            const object = this._gameObjects[i];\r\n            if (!object) {\r\n                continue;\r\n            }\r\n            object.resume();\r\n        }\r\n        this._gameState = GameState.Ongoing;\r\n    }\r\n\r\n    public update(deltaTime: number) {\r\n        let curMousePos = InputManager.getInstance().mousePos;\r\n        let param: MouseParam = {\r\n            mousePos: curMousePos,\r\n        }\r\n        // 应该改成鼠标坐标变化时调用，而不是每一帧都调用\r\n        let hasShowTip = false;\r\n        for (let i = 0; i < this._gameObjects.length; i++) {\r\n            let object = this._gameObjects[i];\r\n            // console.log(object.contains(curMousePos))\r\n            if (object.contains(curMousePos)) {\r\n                if (object != this._curDetectObject) {\r\n                    this._curDetectObject = object;\r\n                    GameTipManager.getInstance().showTip(object.getObjectParam().name, object.getTipData());\r\n                    GameTipManager.getInstance().moveTip(curMousePos);\r\n                    object.mouseOnObject(true, param);\r\n                }\r\n                else {\r\n                    GameTipManager.getInstance().moveTip(curMousePos);\r\n                }\r\n                hasShowTip = true;\r\n                break;\r\n            }\r\n        }\r\n        // 在不需要显示提示并且上一帧有检测到物体（说明现在没检测到\r\n        if (!hasShowTip && this._curDetectObject) {\r\n            GameTipManager.getInstance().hideTip();\r\n            this._curDetectObject = null;\r\n        }\r\n    }\r\n\r\n    public addObject(object: ObjectBase) {\r\n        this._gameObjects.push(object);\r\n    }\r\n\r\n    public removeObject(object: ObjectBase) {\r\n        //this._gameObjects.\r\n    }\r\n}\r\n\r\nexport interface MouseParam {\r\n    mousePos: Vec2,\r\n\r\n}\r\n\r\n"]}
{"version":3,"sources":["file:///D:/cocos_projects/physics_education_game/assets/scripts/manager/map_manager/MapManager.ts"],"names":["_decorator","Singleton","ObjectFactory","Utils","GameManager","MapData","EventManager","EventConstants","ccclass","property","MapManager","init","gameMgr","getInstance","map_root","gameRoot","getChildByName","nextInitManager","dispatchEvent","GameControl","GameStart","setNextInitManager","enterMap","mapName","loadMapData","mapData","i","objectDatas","length","data","object","getObject","objectType","shapeParam","str2vec3","pos","objectParam","addObject"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,a,iBAAAA,a;;AACFC,MAAAA,K;;AACEC,MAAAA,W,iBAAAA,W;;AACFC,MAAAA,O;;AAEAC,MAAAA,Y;;AACEC,MAAAA,c,iBAAAA,c;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;4BAGjBU,U,WADZF,OAAO,CAAC,YAAD,C,gBAAR,MACaE,UADb;AAAA;AAAA,kCAC8D;AAGnDC,QAAAA,IAAI,GAAG;AACV,eAAKC,OAAL,GAAe;AAAA;AAAA,0CAAYC,WAAZ,EAAf;AACA,eAAKC,QAAL,GAAgB,KAAKF,OAAL,CAAaG,QAAb,CAAsBC,cAAtB,CAAqC,UAArC,CAAhB;AACA;AAAA;AAAA,kCAAQH,WAAR,GAAsBF,IAAtB,CAA2B,MAAM;AAC7B,gBAAI,KAAKM,eAAT,EAA0B;AACtB,mBAAKA,eAAL,CAAqBN,IAArB;AACH,aAFD,MAEO;AACH;AAAA;AAAA,gDAAaO,aAAb,CAA2B;AAAA;AAAA,oDAAeC,WAAf,CAA2BC,SAAtD;AACH;AACJ,WAND;AAOH;;AAGMC,QAAAA,kBAAkB,CAACJ,eAAD,EAAkC;AACvD,eAAKA,eAAL,GAAuBA,eAAvB;AACH;;AAEMK,QAAAA,QAAQ,CAACC,OAAD,EAAkB;AAC7B;AAAA;AAAA,kCAAQV,WAAR,GAAsBW,WAAtB,CAAkCD,OAAlC,EAA4CE,OAAD,IAAa;AACpD,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,OAAO,CAACE,WAAR,CAAoBC,MAAxC,EAAgDF,CAAC,EAAjD,EAAqD;AACjD,kBAAIG,IAAI,GAAGJ,OAAO,CAACE,WAAR,CAAoBD,CAApB,CAAX;AACA,kBAAII,MAAM,GAAG;AAAA;AAAA,kDAAcjB,WAAd,GAA4BkB,SAA5B,CAAsCF,IAAI,CAACG,UAA3C,EAAuDH,IAAI,CAACI,UAA5D,EAAwE;AAAA;AAAA,kCAAMC,QAAN,CAAeL,IAAI,CAACM,GAApB,CAAxE,EAAkGN,IAAI,CAACO,WAAvG,EAAoH,KAAKtB,QAAzH,CAAb;AACA,mBAAKF,OAAL,CAAayB,SAAb,CAAuBP,MAAvB;AACH;AACJ,WAND;AAOH;;AA5ByD,O","sourcesContent":["import { _decorator, Node } from \"cc\";\r\nimport { Singleton } from \"../../common/Singleton\";\r\nimport { ObjectFactory } from \"../../modules/game/ObjectFactory\";\r\nimport Utils from \"../../utils/Utils\";\r\nimport { GameManager } from \"../game_manager/GameManager\";\r\nimport MapData, { IOpenObjectData } from \"./MapData\";\r\nimport { IPreInit } from \"../../common/IPreInit\";\r\nimport EventManager from \"../event_manager/EventManager\";\r\nimport { EventConstants } from \"../event_manager/EventConstants\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MapManager')\r\nexport class MapManager extends Singleton implements IPreInit {\r\n    private map_root: Node;\r\n    private gameMgr: GameManager;\r\n    public init() {\r\n        this.gameMgr = GameManager.getInstance();\r\n        this.map_root = this.gameMgr.gameRoot.getChildByName(\"map_root\");\r\n        MapData.getInstance().init(() => {\r\n            if (this.nextInitManager) {\r\n                this.nextInitManager.init();\r\n            } else {\r\n                EventManager.dispatchEvent(EventConstants.GameControl.GameStart);\r\n            }\r\n        });\r\n    }\r\n\r\n    public nextInitManager: IPreInit;\r\n    public setNextInitManager(nextInitManager: IPreInit): void {\r\n        this.nextInitManager = nextInitManager;\r\n    }\r\n\r\n    public enterMap(mapName: string) {\r\n        MapData.getInstance().loadMapData(mapName, (mapData) => {\r\n            for (let i = 0; i < mapData.objectDatas.length; i++) {\r\n                let data = mapData.objectDatas[i] as IOpenObjectData;\r\n                let object = ObjectFactory.getInstance().getObject(data.objectType, data.shapeParam, Utils.str2vec3(data.pos), data.objectParam, this.map_root);\r\n                this.gameMgr.addObject(object);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n\r\n"]}